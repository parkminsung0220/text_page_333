import time

def print_slow(text):
    """텍스트를 천천히 출력하는 함수"""
    for char in text:
        print(char, end='', flush=True)
        time.sleep(0.03)
    print()

def start_game():
    """게임 시작 및 전체 흐름을 제어하는 함수"""
    # --- 게임 시작 ---
    print_slow("========================================================")
    print_slow("      아르카디아 마법학교 졸업 시험: 현자의 탑")
    print_slow("========================================================")
    print_slow("\n당신은 마법학교 졸업을 위한 마지막 관문, '현자의 탑'에 도착했습니다.")
    print_slow("총 3개의 층으로 이루어진 시험을 통과하고 '졸업의 서'에 당신의 이름을 새기세요.")
    input("\n준비가 되었다면 Enter 키를 누르세요...")

    # --- 1단계 시작 ---
    if stage_one():
        # --- 2단계 시작 ---
        if stage_two():
            # --- 3단계 시작 ---
            if stage_three():
                # --- 게임 클리어 ---
                print_slow("\n\n========================================================")
                print_slow("                    🎉 졸업을 축하합니다! 🎉")
                print_slow("========================================================")
                print_slow("\n당신은 현자의 탑의 모든 시험을 통과했습니다.")
                print_slow("'졸업의 서'에 당신의 이름이 새겨지며, 아르카디아 마법학교의")
                print_slow("자랑스러운 졸업생으로 인정받게 되었습니다!")
            else:
                print_slow("\n마지막 시험에서 탈락했습니다. 현자의 탑이 당신을 돌려보냅니다.")
        else:
            print_slow("\n두 번째 시험에서 탈락했습니다. 현자의 탑이 당신을 돌려보냅니다.")
    else:
        print_slow("\n첫 번째 시험에서 탈락했습니다. 현자의 탑이 당신을 돌려보냅니다.")

def stage_one():
    """1단계: 신비한 약초의 방"""
    print_slow("\n\n--- 1단계: 신비한 약초의 방 ---")
    print_slow("첫 번째 시험은 마법 약초에 대한 당신의 지식과 관찰력을 시험합니다.")
    print_slow("방 안의 단서들을 이용해 4자리의 숫자 비밀번호를 찾아 문을 여세요.")

    # 문제 1
    print_slow("\n[문제 1] 책상 위 '마법 식물 도감'이 펼쳐져 있습니다.")
    print_slow("'월광초(月光草)' 설명: 이 식물의 잎사귀는 보름달이 뜰 때만 그 수가 변한다.")
    input("창밖을 클릭하여 밤으로 바꿉니다. (Enter를 누르세요)")
    print_slow("...창밖이 밤으로 변하자 월광초 화분의 잎사귀가 [ 3 ]개로 변했습니다.")
    print_slow(">>> 첫 번째 숫자는 3입니다.")

    # 문제 2
    print_slow("\n[문제 2] 선반 위에 여러 개의 물약병과 쪽지가 있습니다.")
    print_slow("쪽지: 생명의 물약을 만들려면 붉은 약초와 푸른 약초를 몇 대 몇 비율로 섞어야 하는가?")
    input("벽에 걸린 레시피 차트를 확인합니다. (Enter를 누르세요)")
    print_slow("레시피: 생명의 물약 - 붉은 약초 1 : 푸른 약초 [ 6 ]")
    print_slow(">>> 두 번째 숫자는 6입니다.")

    # 문제 3
    print_slow("\n[문제 3] 방 한구석에 잠겨있는 작은 상자가 있습니다.")
    print_slow("상자 문제: 불을 먹고 자라는 도마뱀의 다리 개수는?")
    answer = input("'마법 생물 사전'을 뒤져 정답을 입력하세요: ")
    while answer != "4":
        answer = input("틀렸습니다. 다시 입력하세요: ")
    print_slow("정답입니다! 상자가 열리며 안에서 [ 4 ]라는 숫자가 적힌 쪽지를 발견했습니다.")
    print_slow(">>> 세 번째 숫자는 4입니다.")

    # 문제 4
    print_slow("\n[문제 4] 벽난로 위에 각기 다른 수의 꽃잎을 가진 5개의 수정 꽃이 있습니다.")
    print_slow("힌트: 가장 적은 꽃잎과 가장 많은 꽃잎의 차이가 마지막 숫자이다.")
    input("꽃잎들을 세어봅니다. (2, 5, 8, 9, 11개) (Enter를 누르세요)")
    print_slow("가장 많은 11개와 가장 적은 2개의 차이는 [ 9 ]입니다.")
    print_slow(">>> 네 번째 숫자는 9입니다.")

    # 문 열기
    print_slow("\n----------------------------------------")
    print_slow("모든 숫자를 찾았습니다. 문에 달린 키패드에 4자리 비밀번호를 입력하세요.")
    final_code = input("비밀번호 입력: ")
    while final_code != "3649":
        final_code = input("비밀번호가 틀렸습니다. 다시 입력하세요: ")
    
    print_slow("'철컥' 소리와 함께 다음 층으로 가는 문이 열립니다. 성공입니다!")
    return True

def stage_two():
    """2단계: 고대 마법 주문의 방"""
    print_slow("\n\n--- 2단계: 고대 마법 주문의 방 ---")
    print_slow("두 번째 시험은 고대의 룬 문자와 마법진을 해석하는 능력을 평가합니다.")
    print_slow("흩어진 지식 속에서 4개의 숫자를 찾아내십시오.")

    # 문제 1
    print_slow("\n[문제 1] 방 중앙의 제단 위에 '보호 마법을 발동시켜라'는 문구가 떠 있습니다.")
    print_slow("'기초 룬 문자' 책을 보니, '보호'를 뜻하는 룬 문자는 5개의 선으로 이루어져 있습니다.")
    answer = input("제단에 키보드로 정답을 입력하세요: ")
    while answer != "5":
        answer = input("틀렸습니다. 다시 입력하세요: ")
    print_slow("정답입니다! 보호막이 쳐지며 벽에 첫 번째 숫자 [ 5 ]가 나타납니다.")
    print_slow(">>> 첫 번째 숫자는 5입니다.")

    # 문제 2
    print_slow("\n[문제 2] 벽에는 여러 개의 초상화가 걸려있고 메모가 발견됩니다.")
    print_slow("메모: 아르카디아 마법학교의 2대 교장, '리안드로'의 초상화 뒤에 단서가 있다.")
    input("각 초상화의 명패를 확인하여 2대 교장의 초상화를 클릭합니다. (Enter를 누르세요)")
    print_slow("초상화가 움직이며 뒤에서 두 번째 숫자 [ 2 ]를 찾았습니다.")
    print_slow(">>> 두 번째 숫자는 2입니다.")

    # 문제 3
    print_slow("\n[문제 3] 천장에는 여러 별자리가 그려져 있고 수수께끼가 있습니다.")
    print_slow("수수께끼: 용기의 상징인 '사자자리'는 몇 개의 별로 이루어져 있는가?")
    input("마법 망원경으로 천장의 별자리를 확대해 봅니다. (Enter를 누르세요)")
    print_slow("사자자리를 이루는 주요 별은 [ 8 ]개인 것을 확인했습니다.")
    print_slow(">>> 세 번째 숫자는 8입니다.")

    # 문제 4
    print_slow("\n[문제 4] 마법진이 그려진 바닥 위에 책이 한 권 놓여있습니다.")
    print_slow("책 내용: 시간을 되돌리는 주문은 7개의 단어로 이루어져 있다. 하지만 이 주문을 완성하려면 1개의 단어가 더 필요하다.")
    answer = input("바닥의 마법진 키보드에 필요한 단어의 개수를 입력하세요: ")
    while answer != "1":
        answer = input("틀렸습니다. 다시 입력하세요: ")
    print_slow("정답입니다! 마법진이 빛나며 마지막 숫자 [ 1 ]을 보여줍니다.")
    print_slow(">>> 네 번째 숫자는 1입니다.")

    # 문 열기
    print_slow("\n----------------------------------------")
    print_slow("모든 숫자를 찾았습니다. 문에 4자리 비밀번호를 입력하세요.")
    final_code = input("비밀번호 입력: ")
    while final_code != "5281":
        final_code = input("비밀번호가 틀렸습니다. 다시 입력하세요: ")
    
    print_slow("육중한 돌문이 위로 열리며 마지막 층으로 향하는 계단이 드러납니다. 성공입니다!")
    return True

def stage_three():
    """3단계: 현자의 시험"""
    print_slow("\n\n--- 3단계: 현자의 시험 ---")
    print_slow("마지막 시험은 당신의 지혜와 논리력을 시험합니다.")
    print_slow("이 방의 모든 수수께끼를 풀어 '졸업의 서'를 손에 넣으세요.")

    # 문제 1
    print_slow("\n[문제 1] 거대한 체스판 위에 백과 흑의 말이 몇 개 놓여있습니다.")
    print_slow("힌트: 왕을 제외하고, 백색 진영에 남아있는 말의 총 개수는?")
    input("체스판을 자세히 살펴봅니다. (Enter를 누르세요)")
    print_slow("왕을 제외한 백색 말(룩, 비숍, 나이트, 폰 등)은 총 [ 7 ]개입니다.")
    print_slow(">>> 첫 번째 숫자는 7입니다.")

    # 문제 2
    print_slow("\n[문제 2] 책장에 여러 권의 책이 꽂혀있고 지시가 있습니다.")
    print_slow("지시: 마법의 역사, 제 3장 11절을 보라.")
    answer = input("'마법의 역사' 책을 펼치기 위해 페이지 번호 '113'을 입력하세요: ")
    while answer != "113":
        answer = input("틀렸습니다. 다시 입력하세요: ")
    print_slow("책이 펼쳐지며 내용 속에 강조된 숫자 [ 3 ]을 발견했습니다.")
    print_slow(">>> 두 번째 숫자는 3입니다.")

    # 문제 3
    print_slow("\n[문제 3] 방에는 4원소(불, 물, 바람, 흙)를 상징하는 4개의 수정 구슬이 있습니다.")
    print_slow("문제: 생명의 근원이 되는 원소와 지혜의 상징이 되는 원소의 구슬을 순서대로 클릭하라.")
    input("생명의 근원 '물' 구슬과 지혜의 상징 '바람' 구슬을 차례로 클릭합니다. (Enter를 누르세요)")
    print_slow("두 구슬 사이에 홀로그램으로 숫자 [ 0 ]이 나타납니다.")
    print_slow(">>> 세 번째 숫자는 0입니다.")

    # 문제 4
    print_slow("\n[문제 4] '졸업의 서'가 놓인 단상이 투명한 마법 장벽으로 막혀 있습니다.")
    print_slow("단상 앞 문제: 위대한 마법사 멀린이 이 탑을 세운 해는 4자리 연도이다. 그 해의 각 자릿수를 모두 더한 값이 마지막 열쇠다.")
    input("벽에 걸린 연대표를 확인합니다. '현자의 탑 건립: A.D. 1026' (Enter를 누르세요)")
    answer = input("연도의 각 자릿수를 모두 더한 값을 입력하세요: ")
    while answer != "9":
        answer = input("틀렸습니다. 다시 계산해보세요: ")
    print_slow("정답입니다! 1+0+2+6 = [ 9 ].")
    print_slow(">>> 네 번째 숫자는 9입니다.")

    # 졸업의 서
    print_slow("\n----------------------------------------")
    print_slow("마지막 숫자들을 찾았습니다. 마법 장벽의 키패드에 4자리 비밀번호를 입력하세요.")
    final_code = input("비밀번호 입력: ")
    while final_code != "7309":
        final_code = input("비밀번호가 틀렸습니다. 다시 입력하세요: ")
    
    print_slow("'스르륵' 소리를 내며 마법 장벽이 사라집니다. 성공입니다!")
    return True

# 게임 실행
if __name__ == "__main__":
    start_game()